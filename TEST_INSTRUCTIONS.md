# PDF入力無限リループ修正のテスト手順

## 修正内容の概要
1. APIタイムアウト設定追加（5分）
2. 重複アップロード防止機能
3. 詳細なエラーハンドリング
4. UI状態管理の改善

## テスト準備

### 1. バックエンドサーバー起動
```bash
cd C:\PDFAI\backend
python main.py
```
サーバーが`http://localhost:9000`で起動することを確認

### 2. フロントエンドサーバー起動
```bash
cd C:\PDFAI\frontend
npm start
```
フロントエンドが`http://localhost:3000`で起動することを確認

## 手動テスト項目

### テスト1: 正常なPDFアップロード
**目的**: 修正後も正常なアップロードが動作することを確認

**手順**:
1. ブラウザで`http://localhost:3000`にアクセス
2. 有効なPDFファイル（test.pdf等）をドラッグ&ドロップ
3. アップロード処理の完了を待つ

**期待結果**:
- ✅ アップロード中のスピナーが表示される
- ✅ アップロード完了メッセージが表示される
- ✅ 登録済みドキュメント数が増加する
- ✅ 無限リロードが発生しない

### テスト2: 重複アップロード防止
**目的**: アップロード中の重複実行が防止されることを確認

**手順**:
1. 大きなPDFファイルを用意（時間がかかるもの）
2. ファイルをドラッグ&ドロップしてアップロード開始
3. アップロード中に同じファイルまたは別のファイルを再度ドロップ

**期待結果**:
- ✅ アップロード中はドロップゾーンが無効化される
- ✅ カーソルが`not-allowed`になる
- ✅ 重複アップロードが実行されない
- ✅ 最初のアップロードが正常に完了する

### テスト3: エラーハンドリング
**目的**: 様々なエラー状況で適切なメッセージが表示されることを確認

**手順A - 非PDFファイル**:
1. JPEGやTXTファイルをドロップ

**期待結果**:
- ✅ "PDFファイルのみアップロード可能です" メッセージ表示

**手順B - バックエンド停止状態**:
1. バックエンドサーバーを停止
2. PDFファイルをアップロード

**期待結果**:
- ✅ 適切なエラーメッセージが表示される
- ✅ 無限リトライが発生しない

### テスト4: タイムアウト処理
**目的**: 大きなファイルや処理遅延時のタイムアウトが正常に動作することを確認

**手順**:
1. 非常に大きなPDFファイル（10MB以上）をアップロード
2. 5分間待機

**期待結果**:
- ✅ 5分後にタイムアウトエラーが表示される
- ✅ "アップロードがタイムアウトしました" メッセージ表示
- ✅ アップロード状態がリセットされる

### テスト5: UI状態管理
**目的**: アップロード中のUI状態が正しく管理されることを確認

**手順**:
1. PDFファイルをアップロード開始
2. アップロード中のUI状態を確認
3. アップロード完了後のUI状態を確認

**期待結果**:
- ✅ アップロード中: ドロップゾーンが薄くなる（opacity: 0.7）
- ✅ アップロード中: ボーダーが灰色になる
- ✅ アップロード中: スピナーアニメーション表示
- ✅ 完了後: 通常状態に戻る

## 自動テスト結果

### フロントエンド（TypeScript）
- ✅ `npm run build` - コンパイル成功
- ✅ 型チェック通過

### バックエンド（Python）
- ✅ APIエンドポイント実装確認
- 📝 サーバー起動必要（手動テストで確認）

## 修正したファイル一覧
- `frontend/src/services/api.ts` - タイムアウト設定追加
- `frontend/src/components/FileUpload.tsx` - エラーハンドリング強化、UI改善

## トラブルシューティング

### サーバー起動エラー
- ポート9000が使用中の場合は他のプロセスを終了
- Python依存関係の不足がある場合は`pip install -r requirements.txt`

### フロントエンド起動エラー
- `npm install`でパッケージを再インストール
- ポート3000が使用中の場合は別ポートを使用

### アップロードが動作しない
- バックエンドサーバーが起動していることを確認
- ブラウザのコンソールでエラーログを確認
- ネットワークタブでAPI通信を確認